{"ast":null,"code":"import _slicedToArray from\"C:/Users/mehr0/Documents/Dev/simpleforum/hwryeol_simpleforum/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import styles from\"./Comments.module.css\";import{Link}from\"react-router-dom\";import{useEffect,useRef,useState}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Comments(_ref){var no=_ref.no,setIsRedirectLogin=_ref.setIsRedirectLogin,getMaxSeq=_ref.getMaxSeq,aaa=_ref.aaa,isLogined=_ref.isLogined;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),isReplyList=_useState2[0],setIsReplyList=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),comments=_useState4[0],setComments=_useState4[1];var reply_inputList=useRef([]);function getComments(){fetch(\"/comments/\".concat(no)).then(function(res){return res.json();}).then(function(data){var commentsData=data;commentsData.length>0&&getMaxSeq(commentsData[commentsData.length-1].seq);setComments(data);setIsReplyList(Array.from({length:commentsData.length},function(){return false;}));});}function deleteComments(index){if(window.confirm(\"댓글을 삭제하겠습니까?\")){fetch(\"/comments/\".concat(no),{method:\"DELETE\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({id:comments[index].id})}).then(getComments());}}function createReply(ref,seq,lvl){fetch(\"/comments/\".concat(no),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({contents:ref.value,seq:seq,lvl:lvl})}).then(function(res){if(res.status===401){alert(\"로그인이 필요합니다\");setIsRedirectLogin(true);}getComments();});}useEffect(function(){getComments();},[aaa]);return/*#__PURE__*/_jsx(_Fragment,{children:comments.map(function(data,index){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:data.lvl>0?styles.reply:styles.comments,style:{left:\"\".concat(data.lvl*20,\"px\")},children:[/*#__PURE__*/_jsx(\"div\",{className:styles.comments_nickname,children:data.nickname}),/*#__PURE__*/_jsx(\"div\",{className:styles.comments_contents,onClick:function onClick(){var newReplyList=isReplyList.map(function(data,idx){if(idx===index){return!data;}});setIsReplyList(newReplyList);},children:data.contents}),/*#__PURE__*/_jsx(\"div\",{className:styles.comments_create_at,children:data.create_at.replace(/T|Z/g,' ').slice(5,19)}),/*#__PURE__*/_jsx(\"button\",{className:isLogined?styles.comments_delete_button:styles.hidden,onClick:function onClick(event){deleteComments(index);},children:\"X\"})]},\"commentsList\".concat(index)),/*#__PURE__*/_jsxs(\"div\",{className:isReplyList[index]?[styles.reply_form,styles.col].join(\" \"):[styles.reply_form,styles.hidden].join(\" \"),children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"\\uB2F5\\uAE00\\uC744 \\uC785\\uB825\\uD558\\uC138\\uC694\",ref:function ref(el){return reply_inputList.current[index]=el;},type:\"text\",className:styles.reply_input}),/*#__PURE__*/_jsx(\"button\",{className:styles.reply_input_button,onClick:function onClick(event){createReply(reply_inputList.current[index],data.seq,data.lvl+1);},children:\"\\uB4F1\\uB85D\"})]})]});})});}export default Comments;","map":{"version":3,"sources":["C:/Users/mehr0/Documents/Dev/simpleforum/hwryeol_simpleforum/src/Comments.js"],"names":["styles","Link","useEffect","useRef","useState","Comments","no","setIsRedirectLogin","getMaxSeq","aaa","isLogined","isReplyList","setIsReplyList","comments","setComments","reply_inputList","getComments","fetch","then","res","json","data","commentsData","length","seq","Array","from","deleteComments","index","window","confirm","method","headers","body","JSON","stringify","id","createReply","ref","lvl","contents","value","status","alert","map","reply","left","comments_nickname","nickname","comments_contents","newReplyList","idx","comments_create_at","create_at","replace","slice","comments_delete_button","hidden","event","reply_form","col","join","el","current","reply_input","reply_input_button"],"mappings":"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","sourcesContent":["import styles from \"./Comments.module.css\";\r\nimport {Link} from \"react-router-dom\";\r\nimport { useEffect,useRef, useState } from \"react\";\r\n\r\nfunction Comments({no,setIsRedirectLogin,getMaxSeq,aaa,isLogined}){\r\n    const [isReplyList,setIsReplyList] = useState([]);\r\n    const [comments,setComments] = useState([]);\r\n    const reply_inputList = useRef([]);\r\n\r\n    function getComments(){\r\n        fetch(`/comments/${no}`).then(res=>res.json()).then(data=>{\r\n            const commentsData = data;\r\n            commentsData.length>0&&getMaxSeq(commentsData[ commentsData.length-1].seq)\r\n            setComments(data);  \r\n            setIsReplyList(Array.from({length: commentsData.length},()=>false));\r\n            \r\n        })\r\n    }\r\n\r\n    function deleteComments(index){\r\n        if(window.confirm(\"댓글을 삭제하겠습니까?\")){\r\n            fetch(`/comments/${no}`,{\r\n                method:\"DELETE\",\r\n                headers:{\r\n                    \"Content-Type\": \"application/json\"\r\n                },\r\n                body:JSON.stringify({\r\n                    id:comments[index].id\r\n                })\r\n            }).then(getComments())\r\n        }\r\n    }\r\n\r\n    function createReply(ref,seq,lvl){\r\n        fetch(`/comments/${no}`,{\r\n            method:\"POST\",\r\n            headers:{\r\n                \"Content-Type\": \"application/json\"\r\n              },\r\n            body:JSON.stringify({\r\n                contents:ref.value,\r\n                seq:seq,\r\n                lvl:lvl\r\n            })\r\n        }).then(res=>{     \r\n            if(res.status === 401){\r\n                alert(\"로그인이 필요합니다\")\r\n                setIsRedirectLogin(true);\r\n            }\r\n            getComments()\r\n        })\r\n        \r\n    }\r\n    useEffect(()=>{\r\n        getComments();\r\n    },[aaa])\r\n\r\n    return <>{comments.map((data,index)=>{\r\n        return <><div key={`commentsList${index}`} className={data.lvl>0?styles.reply:styles.comments} style={{left:`${(data.lvl)*20}px`}}>\r\n                <div className={styles.comments_nickname}>{data.nickname}</div>\r\n                <div className={styles.comments_contents} onClick={()=>{\r\n                    const newReplyList = isReplyList.map((data,idx)=>{\r\n                        if(idx === index){\r\n                            return !data\r\n                        }\r\n                    });\r\n                    setIsReplyList(newReplyList)\r\n                }}>{data.contents}</div>\r\n                <div className={styles.comments_create_at}>{data.create_at.replace(/T|Z/g,' ').slice(5,19)}</div>\r\n                <button className={isLogined?styles.comments_delete_button:styles.hidden} onClick={(event)=>{\r\n                    deleteComments(index);\r\n                }}>X</button>\r\n        </div>\r\n        <div className={isReplyList[index]?[styles.reply_form,styles.col].join(\" \"):[styles.reply_form,styles.hidden].join(\" \")}>\r\n        <textarea placeholder=\"답글을 입력하세요\" ref={el=>reply_inputList.current[index] = el} type=\"text\" className={styles.reply_input}></textarea>\r\n        <button className={styles.reply_input_button} onClick={(event)=>{\r\n            createReply(reply_inputList.current[index],data.seq,data.lvl+1);\r\n        }}>등록</button>\r\n    </div></>\r\n    })}\r\n    </>\r\n}\r\nexport default Comments;"]},"metadata":{},"sourceType":"module"}